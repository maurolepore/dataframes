---
title: "Starting with data in R"
subtitle: What are data frames?
output: html_document
---

```{r pkg}
library(tidyverse)
```

# Setup

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  comment = "#>",
  collapse = TRUE
)
```

```{r project-options}
# Start with a fresh environment for a reproducible workflow.
# Commenting because this should be run only once
# install.packages("usethis")
# usethis::use_blank_slate("project")
# ● In Global Options > General, do NOT check "Restore .RData into workspace at startup".
# ● In Global Options > General, set "Save workspace to .RData on exit" to "Never".
```

# Data

```{r data, eval=FALSE}
# Commenting because this should be run only once
# dir.create("data")
# download.file("https://ndownloader.figshare.com/files/2292169", "data/portal_data_joined.csv")
```

Info via http://www.datacarpentry.org/R-ecology-lesson/02-starting-with-data

> We are studying the species repartition and weight of animals caught in plots in our study area. The dataset is stored as a comma separated value (CSV) file. Each row holds information for a single animal, and the columns represent:

![](https://i.imgur.com/8CKkV5j.png)

```{r}
surveys <- read.csv("data/portal_data_joined.csv")
head(surveys)
```

```{r}
str(surveys)
```

```{r}
# Also
# View(surveys)
```

```{r options-change}
# WARNING: The next few code chunks print extreemely long objects. Avoiding this
# by temprarily changing global options.
old_ops <- options(max.print = 20)
```


```{r print-long-objects-1, eval=TRUE, rows.print = 5}
# first element in the first column of the data frame (as a vector)
surveys[1, 1]   
# first element in the 6th column (as a vector)
surveys[1, 6]   
# first column of the data frame (as a vector)
surveys[, 1]    
# first column of the data frame (as a data.frame)
surveys[1]      
# first three elements in the 7th column (as a vector)
surveys[1:3, 7] 
# the 3rd row of the data frame (as a data.frame)
surveys[3, ]    
# equivalent to head_surveys <- head(surveys)
head_surveys <- surveys[1:6, ] 
```

```{r print-long-objects-2, eval=TRUE}
head_surveys <- surveys[1:6, ] 
```

```{r, rows.print = 5}
# The whole data frame, except the first column
surveys[, -1]          
# Equivalent to head(surveys)
surveys[-c(7:34786), ]
```

```{r}
# Result is a data.frame
surveys["species_id"]       
# Result is a vector
surveys[, "species_id"]     
# Result is a vector
surveys[["species_id"]]     
# Result is a vector
surveys$species_id
```
```{r options-restore}
# Restoring previous global options
options(old_ops)
```

Challenge

```{r}
## 1.
surveys_200 <- surveys[200, ]
## 2.
# Saving `n_rows` to improve readability and reduce duplication
n_rows <- nrow(surveys)
surveys_last <- surveys[n_rows, ]
## 3.
surveys_middle <- surveys[n_rows / 2, ]
## 4.
surveys_head <- surveys[-(7:n_rows), ]
```


# Factors

```{r}
sex <- factor(c("male", "female", "female", "male"))
levels(sex)
nlevels(sex)
sex
sex <- factor(sex, levels = c("male", "female"))
sex # after re-ordering
```

```{r}
as.character(sex)

f <- factor(c(1990, 1983, 1977, 1998, 1990))
as.numeric(f)               # Wrong! And there is no warning...
as.numeric(as.character(f)) # Works...
as.numeric(levels(f))[f]    # The recommended way.
```

```{r}
## bar plot of the number of females and males captured during the experiment:
plot(surveys$sex)
```

```{r}
sex <- surveys$sex
head(sex)
levels(sex)
```

# stringsAsFactors

```{r}
## Compare the difference between our data read as `factor` vs `character`.
surveys <- read.csv("data/portal_data_joined.csv", stringsAsFactors = TRUE)
str(surveys)
surveys <- read.csv("data/portal_data_joined.csv", stringsAsFactors = FALSE)
str(surveys)
## Convert the column "plot_type" into a factor
surveys$plot_type <- factor(surveys$plot_type)
```

# Dates

```{r}
# install.packages("tidyverse")
library(lubridate)

my_date <- ymd("2015-01-01")
str(my_date)

# sep indicates the character to use to separate each component
my_date <- ymd(paste("2015", "1", "1", sep = "-")) 
str(my_date)

paste(surveys$year, surveys$month, surveys$day, sep = "-")

ymd(paste(surveys$year, surveys$month, surveys$day, sep = "-"))

surveys$date <- ymd(paste(surveys$year, surveys$month, surveys$day, sep = "-"))
str(surveys) # notice the new column, with 'date' as the class

summary(surveys$date)
```

```{r}
is_missing_date <- is.na(surveys$date)
date_columns <- c("year", "month", "day")
missing_dates <- surveys[is_missing_date,  date_columns]
head(missing_dates)
```

```{r}
library(readr)

download_link <- "https://ndownloader.figshare.com/files/2292169"
surveys <- read_csv(download_link)

# What are three ways to view `surveys`?
# Way 1
View(surveys)
# Way 2
surveys
# Way 3 (YOUR TURN)



is_missing_date <- is.na(surveys$date)
date_columns <- c("year", "month", "day")
missing_dates <- surveys[is_missing_date,  date_columns]
head(missing_dates)
```

